{% extends 'base.html' %}
{% block content %}
<div class="container-fluid px-0">
  <!-- Enhanced Hero Section -->
  <section class="hero-section position-relative overflow-hidden">
    <div class="hero-background"></div>
    <div class="hero-overlay"></div>
    <div class="container position-relative">
      <div class="row align-items-center min-vh-50">
        <div class="col-lg-8 mx-auto text-center text-white" data-aos="fade-up">
          <div class="hero-content">
            <h1 class="display-4 fw-bold mb-4">Professional Home Services</h1>
            <p class="lead mb-4">Discover and book verified professionals for all your home maintenance needs. Quality service, guaranteed satisfaction.</p>
            
            <!-- Search Bar -->
            <div class="search-container mb-4">
              <div class="row justify-content-center">
                <div class="col-lg-8">
                  <div class="input-group input-group-lg">
                    <span class="input-group-text bg-white border-0">
                      <i class="fas fa-search text-muted"></i>
                    </span>
                    <input type="text" class="form-control border-0 shadow-sm" id="serviceSearch" placeholder="Search for services...">
                    <button class="btn btn-primary px-4" type="button" id="searchBtn">
                      <i class="fas fa-search me-2"></i>Search
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="hero-stats">
              <div class="row text-center">
                <div class="col-4">
                  <div class="stat-item">
                    <div class="h3 mb-0 fw-bold" id="totalServices">0</div>
                    <small>Services Available</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="stat-item">
                    <div class="h3 mb-0 fw-bold">500+</div>
                    <small>Verified Pros</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="stat-item">
                    <div class="h3 mb-0 fw-bold">24/7</div>
                    <small>Support</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Service Categories Section -->
  <section class="py-5 bg-white">
    <div class="container">
      <div class="row mb-5">
        <div class="col-lg-8 mx-auto text-center">
          <h2 class="display-6 fw-bold text-primary mb-3" data-aos="fade-up">Service Categories</h2>
          <p class="lead text-muted" data-aos="fade-up" data-aos-delay="100">Choose from our comprehensive range of professional services</p>
        </div>
      </div>
      
      <!-- Category Filter Buttons -->
      <div class="row mb-5">
        <div class="col-12">
          <div class="d-flex flex-wrap justify-content-center gap-2" id="categoryFilters">
            <button class="btn btn-outline-primary rounded-pill px-4 py-2 category-filter active" data-category="all">
              <i class="fas fa-th-large me-2"></i>All Services
            </button>
            <button class="btn btn-outline-primary rounded-pill px-4 py-2 category-filter" data-category="electrician">
              <i class="fas fa-bolt me-2"></i>Electrician
            </button>
            <button class="btn btn-outline-primary rounded-pill px-4 py-2 category-filter" data-category="plumber">
              <i class="fas fa-wrench me-2"></i>Plumber
            </button>
            <button class="btn btn-outline-primary rounded-pill px-4 py-2 category-filter" data-category="carpenter">
              <i class="fas fa-hammer me-2"></i>Carpenter
            </button>
            <button class="btn btn-outline-primary rounded-pill px-4 py-2 category-filter" data-category="cleaner">
              <i class="fas fa-broom me-2"></i>Cleaner
            </button>
            <button class="btn btn-outline-primary rounded-pill px-4 py-2 category-filter" data-category="painter">
              <i class="fas fa-paint-brush me-2"></i>Painter
            </button>
            <button class="btn btn-outline-primary rounded-pill px-4 py-2 category-filter" data-category="ac">
              <i class="fas fa-snowflake me-2"></i>AC Repair
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Grid Section -->
  <section class="py-5 bg-light">
    <div class="container">
      <div class="row mb-4">
        <div class="col-lg-6">
          <h3 class="fw-bold text-dark mb-0">Available Services</h3>
          <p class="text-muted">Professional services tailored to your needs</p>
        </div>
        <div class="col-lg-6 text-lg-end">
          <div class="d-flex gap-2 justify-content-lg-end">
            <select class="form-select" id="sortBy" style="width: auto;">
              <option value="name">Sort by Name</option>
              <option value="category">Sort by Category</option>
              <option value="rating">Highest Rated</option>
            </select>
            <div class="btn-group" role="group">
              <input type="radio" class="btn-check" name="viewMode" id="gridView" autocomplete="off" checked>
              <label class="btn btn-outline-primary" for="gridView">
                <i class="fas fa-th"></i>
              </label>
              <input type="radio" class="btn-check" name="viewMode" id="listView" autocomplete="off">
              <label class="btn btn-outline-primary" for="listView">
                <i class="fas fa-list"></i>
              </label>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Loading State -->
      <div id="loadingState" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="text-muted mt-3">Loading services...</p>
      </div>
      
      <!-- Services Grid -->
      <div id="servicesGrid" class="row g-4"></div>
      
      <!-- No Services State -->
      <div id="noServicesState" class="text-center py-5 d-none">
        <div class="mb-4">
          <i class="fas fa-search text-muted" style="font-size: 4rem;"></i>
        </div>
        <h4 class="text-muted mb-3">No services found</h4>
        <p class="text-muted mb-4">Try adjusting your search or filter criteria</p>
        <button class="btn btn-primary" onclick="clearFilters()">
          <i class="fas fa-refresh me-2"></i>Clear Filters
        </button>
      </div>
      
      <!-- Load More Button -->
      <div class="text-center mt-5" id="loadMoreContainer" style="display: none;">
        <button class="btn btn-outline-primary btn-lg" id="loadMoreBtn">
          <i class="fas fa-plus me-2"></i>Load More Services
        </button>
      </div>
    </div>
  </section>

  <!-- Why Choose Us Section -->
  <section class="py-5 bg-white">
    <div class="container">
      <div class="row mb-5">
        <div class="col-lg-8 mx-auto text-center">
          <h2 class="display-6 fw-bold text-dark mb-3" data-aos="fade-up">Why Choose Hofix?</h2>
          <p class="lead text-muted" data-aos="fade-up" data-aos-delay="100">We make home services simple, reliable, and affordable</p>
        </div>
      </div>
      <div class="row g-4">
        <div class="col-lg-3 col-md-6" data-aos="fade-up" data-aos-delay="50">
          <div class="trust-item text-center p-4">
            <div class="trust-icon mx-auto mb-3">
              <i class="fas fa-shield-alt text-success"></i>
            </div>
            <h4 class="fw-bold mb-2">Verified Providers</h4>
            <p class="text-muted small">All professionals are background checked and verified</p>
          </div>
        </div>
        <div class="col-lg-3 col-md-6" data-aos="fade-up" data-aos-delay="100">
          <div class="trust-item text-center p-4">
            <div class="trust-icon mx-auto mb-3">
              <i class="fas fa-clock text-primary"></i>
            </div>
            <h4 class="fw-bold mb-2">Quick Response</h4>
            <p class="text-muted small">Average response time of under 15 minutes</p>
          </div>
        </div>
        <div class="col-lg-3 col-md-6" data-aos="fade-up" data-aos-delay="150">
          <div class="trust-item text-center p-4">
            <div class="trust-icon mx-auto mb-3">
              <i class="fas fa-star text-warning"></i>
            </div>
            <h4 class="fw-bold mb-2">Quality Guaranteed</h4>
            <p class="text-muted small">100% satisfaction guarantee on all services</p>
          </div>
        </div>
        <div class="col-lg-3 col-md-6" data-aos="fade-up" data-aos-delay="200">
          <div class="trust-item text-center p-4">
            <div class="trust-icon mx-auto mb-3">
              <i class="fas fa-headset text-info"></i>
            </div>
            <h4 class="fw-bold mb-2">24/7 Support</h4>
            <p class="text-muted small">Round-the-clock customer support</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  

  <!-- Final CTA Section -->
  <section class="py-5 bg-primary text-white">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8" data-aos="fade-right">
          <h3 class="display-6 fw-bold mb-3">Ready to Book a Service?</h3>
          <p class="lead mb-0">Join thousands of satisfied customers who trust Hofix for their home service needs.</p>
        </div>
        <div class="col-lg-4 text-lg-end" data-aos="fade-left">
          <a href="/booking-map" class="btn btn-light btn-lg px-4 py-3 rounded-pill shadow-lg hover-lift">
            <i class="fas fa-calendar-plus me-2"></i>Book Service Now
          </a>
        </div>
      </div>
    </div>
  </section>
</div>
{% endblock %}
{% block scripts %}
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script>
AOS.init({ once: true, duration: 600 });

// Service icons mapping
const serviceIcons = {
  'Electrician': 'fas fa-bolt',
  'Plumber': 'fas fa-wrench',
  'Carpenter': 'fas fa-hammer',
  'Cleaner': 'fas fa-broom',
  'Painter': 'fas fa-paint-brush',
  'AC Repair': 'fas fa-snowflake'
};

// Global variables
let allServices = [];
let filteredServices = [];
let currentPage = 1;
const servicesPerPage = 12;
let currentCategory = 'all';
let currentSort = 'name';
let currentView = 'grid';

// Load services
async function loadServices() {
  try {
    showLoading(true);
    const response = await fetch('/api/services');
    const data = await response.json();
    
    
    if (!Array.isArray(data)) {
      allServices = [];
    } else {
      allServices = data;
    }
    
    
    document.getElementById('totalServices').textContent = allServices.length;
    applyFilters();
    showLoading(false);
  } catch (error) {
    console.error('Error loading services:', error);
    showError('Failed to load services. Please try again.');
    showLoading(false);
  }
}


// Show/hide loading state
function showLoading(show) {
  const loadingState = document.getElementById('loadingState');
  const servicesGrid = document.getElementById('servicesGrid');
  const noServicesState = document.getElementById('noServicesState');
  
  if (show) {
    loadingState.classList.remove('d-none');
    servicesGrid.classList.add('d-none');
    noServicesState.classList.add('d-none');
  } else {
    loadingState.classList.add('d-none');
    servicesGrid.classList.remove('d-none');
  }
}

// Show error message
function showError(message) {
  const servicesGrid = document.getElementById('servicesGrid');
  servicesGrid.innerHTML = `
    <div class="col-12">
      <div class="alert alert-danger text-center">
        <i class="fas fa-exclamation-triangle me-2"></i>
        ${message}
      </div>
    </div>
  `;
}

// Apply filters and sorting
function applyFilters() {
  // Filter by category
  if (currentCategory === 'all') {
    filteredServices = [...allServices];
  } else {
    filteredServices = allServices.filter(service => 
      service.name.toLowerCase().includes(currentCategory.toLowerCase()) ||
      (service.category && service.category.toLowerCase().includes(currentCategory.toLowerCase()))
    );
  }
  
  // Sort services
  filteredServices.sort((a, b) => {
    switch (currentSort) {
      case 'name':
        return a.name.localeCompare(b.name);
      case 'category':
        return (a.category || '').localeCompare(b.category || '');
      case 'rating':
        return (b.rating || 0) - (a.rating || 0);
      default:
        return 0;
    }
  });
  
  renderServices();
}

// Render services
function renderServices() {
  const servicesGrid = document.getElementById('servicesGrid');
  const noServicesState = document.getElementById('noServicesState');
  const loadMoreContainer = document.getElementById('loadMoreContainer');
  
  if (filteredServices.length === 0) {
    servicesGrid.classList.add('d-none');
    noServicesState.classList.remove('d-none');
    loadMoreContainer.style.display = 'none';
    return;
  }
  
  servicesGrid.classList.remove('d-none');
  noServicesState.classList.add('d-none');
  
  const startIndex = 0;
  const endIndex = Math.min(startIndex + servicesPerPage, filteredServices.length);
  const servicesToShow = filteredServices.slice(startIndex, endIndex);
  
  
  if (currentView === 'grid') {
    renderGridView(servicesToShow);
  } else {
    renderListView(servicesToShow);
  }
  
  // Show/hide load more button
  if (filteredServices.length > servicesPerPage) {
    loadMoreContainer.style.display = 'block';
  } else {
    loadMoreContainer.style.display = 'none';
  }
}

// Render grid view
function renderGridView(services) {
  const servicesGrid = document.getElementById('servicesGrid');
  servicesGrid.innerHTML = '';
  
  services.forEach((service, index) => {
    const icon = serviceIcons[service.name] || 'fas fa-tools';
    const card = document.createElement('div');
    card.className = 'col-lg-4 col-md-6';
    card.innerHTML = `
      <div class="service-card h-100 p-4 rounded-4 shadow-sm bg-white border-0 hover-lift" data-aos="fade-up" data-aos-delay="${index * 100}">
        <div class="service-icon-wrapper mb-3">
          <i class="${icon} text-primary"></i>
        </div>
        <h5 class="fw-bold mb-2">${service.name}</h5>
        <p class="text-muted small mb-3">${service.category || 'Professional Service'}</p>
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="badge bg-light text-dark">Available</span>
          <span class="badge bg-success text-white">Popular</span>
        </div>
        <div class="d-flex gap-2">
          <a href="/services/${service.id}/view" class="btn btn-outline-primary flex-fill">
            <i class="fas fa-eye me-1"></i>View
          </a>
          <a href="/booking-map?service_id=${service.id}&booking_type=daily" class="btn btn-success flex-fill">
            <i class="fas fa-calendar-day me-1"></i>Book Daily
          </a>
          <a href="/booking-map?service_id=${service.id}" class="btn btn-primary flex-fill">
            <i class="fas fa-calendar-plus me-1"></i>Book Now
          </a>
        </div>
      </div>`;
    servicesGrid.appendChild(card);
  });
}

// Render list view
function renderListView(services) {
  const servicesGrid = document.getElementById('servicesGrid');
  servicesGrid.innerHTML = '';
  
  services.forEach((service, index) => {
    const icon = serviceIcons[service.name] || 'fas fa-tools';
    const card = document.createElement('div');
    card.className = 'col-12';
    card.innerHTML = `
      <div class="service-card p-4 rounded-4 shadow-sm bg-white border-0 hover-lift" data-aos="fade-up" data-aos-delay="${index * 50}">
        <div class="row align-items-center">
          <div class="col-md-1">
            <div class="service-icon-wrapper">
              <i class="${icon} text-primary"></i>
            </div>
          </div>
          <div class="col-md-4">
            <h5 class="fw-bold mb-1">${service.name}</h5>
            <p class="text-muted small mb-0">${service.category || 'Professional Service'}</p>
          </div>
          <div class="col-md-2 text-center">
            <span class="badge bg-success text-white fs-6">Available</span>
            <div class="text-muted small">Professional Service</div>
          </div>
          <div class="col-md-2 text-center">
            <div class="stars">
              <i class="fas fa-star text-warning"></i>
              <i class="fas fa-star text-warning"></i>
              <i class="fas fa-star text-warning"></i>
              <i class="fas fa-star text-warning"></i>
              <i class="fas fa-star text-warning"></i>
            </div>
            <div class="text-muted small">4.8 (120 reviews)</div>
          </div>
          <div class="col-md-3 text-end">
            <div class="d-flex gap-2 justify-content-end">
              <a href="/services/${service.id}" class="btn btn-outline-primary btn-sm">
                <i class="fas fa-eye me-1"></i>View
              </a>
              <a href="/booking-map?service_id=${service.id}" class="btn btn-primary btn-sm">
                <i class="fas fa-calendar-plus me-1"></i>Book Now
              </a>
            </div>
          </div>
        </div>
      </div>`;
    servicesGrid.appendChild(card);
  });
}

// Clear all filters
function clearFilters() {
  currentCategory = 'all';
  currentSort = 'name';
  document.getElementById('serviceSearch').value = '';
  
  // Reset category buttons
  document.querySelectorAll('.category-filter').forEach(btn => {
    btn.classList.remove('active');
  });
  document.querySelector('[data-category="all"]').classList.add('active');
  
  // Reset sort dropdown
  document.getElementById('sortBy').value = 'name';
  
  applyFilters();
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
  loadServices();
  
  // Search functionality
  document.getElementById('serviceSearch').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    if (searchTerm === '') {
      applyFilters();
    } else {
      filteredServices = allServices.filter(service => 
        service.name.toLowerCase().includes(searchTerm) ||
        (service.category && service.category.toLowerCase().includes(searchTerm)) ||
        (service.description && service.description.toLowerCase().includes(searchTerm))
      );
      renderServices();
    }
  });
  
  // Search button
  document.getElementById('searchBtn').addEventListener('click', function() {
    const searchTerm = document.getElementById('serviceSearch').value.toLowerCase();
    if (searchTerm === '') {
      applyFilters();
    } else {
      filteredServices = allServices.filter(service => 
        service.name.toLowerCase().includes(searchTerm) ||
        (service.category && service.category.toLowerCase().includes(searchTerm)) ||
        (service.description && service.description.toLowerCase().includes(searchTerm))
      );
      renderServices();
    }
  });
  
  // Category filters
  document.querySelectorAll('.category-filter').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.category-filter').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      currentCategory = this.dataset.category;
      applyFilters();
    });
  });
  
  // Sort dropdown
  document.getElementById('sortBy').addEventListener('change', function() {
    currentSort = this.value;
    applyFilters();
  });
  
  // View mode toggle
  document.querySelectorAll('input[name="viewMode"]').forEach(radio => {
    radio.addEventListener('change', function() {
      if (this.checked) {
        currentView = this.id === 'gridView' ? 'grid' : 'list';
        renderServices();
      }
    });
  });
  
  // Load more button
  document.getElementById('loadMoreBtn').addEventListener('click', function() {
    // This would load more services in a real implementation
    console.log('Load more clicked');
  });
});

// Make clearFilters available globally
window.clearFilters = clearFilters;
</script>
{% endblock %}

