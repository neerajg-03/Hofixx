{% extends "base.html" %}

{% block title %}Hofix - Home Services Made Easy{% endblock %}

{% block scripts %}
<!-- Google Maps API for location services -->
<!-- Using configured Google Maps API key for geolocation and reverse geocoding -->
<!-- Fallback to BigDataCloud API if Google Maps is unavailable -->
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAG0GnKSwNcd_HtC1x1xVdzf-aWtzTIGBs&libraries=places&callback=initGoogleMaps"></script>
<script>
  // Initialize Google Maps when loaded
  function initGoogleMaps() {
    console.log('Google Maps API loaded successfully');
    initializeLocationAutocomplete();
  }
  
  // Initialize Google Places Autocomplete
  function initializeLocationAutocomplete() {
    const locationInput = document.getElementById('location');
    
    if (typeof google !== 'undefined' && google.maps && google.maps.places) {
      const autocomplete = new google.maps.places.Autocomplete(locationInput, {
        types: ['address', 'establishment'],
        componentRestrictions: { country: 'in' }, // Restrict to India
        fields: ['formatted_address', 'geometry', 'place_id']
      });
      
      autocomplete.addListener('place_changed', function() {
        const place = autocomplete.getPlace();
        
        if (place.geometry && place.geometry.location) {
          const lat = place.geometry.location.lat();
          const lng = place.geometry.location.lng();
          
          // Store coordinates in the input
          locationInput.dataset.lat = lat;
          locationInput.dataset.lng = lng;
          
          // Update status
          updateLocationStatus('Address selected successfully', 'success');
          
          // Hide status after 2 seconds
          setTimeout(() => {
            const locationStatus = document.getElementById('locationStatus');
            locationStatus.style.display = 'none';
          }, 2000);
        }
      });
      
      console.log('Google Places Autocomplete initialized');
    } else {
      console.log('Google Places API not available');
    }
  }
</script>
{% endblock %}

{% block content %}
<!-- Animated Hero Section -->
<section class="hero-section text-white">
  <div class="hero-background">
    <div class="floating-shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
      <div class="shape shape-4"></div>
      <div class="shape shape-5"></div>
      <div class="shape shape-6"></div>
    </div>
    <div class="particles-container" id="particles-js"></div>
  </div>
  <div class="hero-overlay"></div>
  <div class="container hero-content">
    <div class="row align-items-center min-vh-75">
      <div class="col-lg-6">
        <div class="hero-text animate-fade-in-up">
          <h1 class="display-3 fw-bold mb-4 animate-text-reveal">
            <span class="text-gradient">Home Services</span><br>
            <span class="text-gradient">Made Easy</span>
          </h1>
          <p class="lead mb-4 animate-fade-in-up" style="animation-delay: 0.3s;">
            Connect with trusted local professionals for all your home service needs. 
            From plumbing to electrical work, we've got you covered with quality service at your doorstep.
          </p>
          <div class="d-flex gap-3 animate-fade-in-up" style="animation-delay: 0.6s;">
            <a href="#quick-booking" class="btn btn-light btn-lg btn-animated">
              <i class="fas fa-calendar-plus me-2"></i>Book Now
              <span class="btn-ripple"></span>
            </a>
            <a href="#how-it-works" class="btn btn-outline-light btn-lg btn-animated">
              <i class="fas fa-play me-2"></i>How It Works
              <span class="btn-ripple"></span>
            </a>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="hero-visual animate-fade-in-up" style="animation-delay: 0.9s;">
          <div class="website-info-grid">
            <!-- Stats Section -->
            <div class="info-card stats-card animate-slide-up" style="animation-delay: 0s;">
              <div class="info-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="info-content">
                <h3 class="stats-number animate-counter" data-target="0" id="customersCount">0</h3>
                <p class="info-label">Happy Customers</p>
              </div>
            </div>
            
            <div class="info-card stats-card animate-slide-up" style="animation-delay: 0.2s;">
              <div class="info-icon">
                <i class="fas fa-user-tie"></i>
              </div>
              <div class="info-content">
                <h3 class="stats-number animate-counter" data-target="0" id="providersCount">0</h3>
                <p class="info-label">Verified Providers</p>
              </div>
            </div>
            
            <div class="info-card stats-card animate-slide-up" style="animation-delay: 0.4s;">
              <div class="info-icon">
                <i class="fas fa-tools"></i>
              </div>
              <div class="info-content">
                <h3 class="stats-number animate-counter" data-target="0" id="servicesCount">0</h3>
                <p class="info-label">Service Categories</p>
              </div>
            </div>
            
            <!-- Features Section -->
            <div class="info-card feature-card animate-slide-up" style="animation-delay: 0.6s;">
              <div class="info-icon">
                <i class="fas fa-shield-alt"></i>
              </div>
              <div class="info-content">
                <h4 class="feature-title">100% Verified</h4>
                <p class="feature-desc">All providers are background checked</p>
              </div>
            </div>
            
            <div class="info-card feature-card animate-slide-up" style="animation-delay: 0.8s;">
              <div class="info-icon">
              <i class="fas fa-bolt"></i>
            </div>
              <div class="info-content">
                <h4 class="feature-title">Fast Service</h4>
                <p class="feature-desc">Emergency service in 10 minutes</p>
            </div>
            </div>
            
            <div class="info-card feature-card animate-slide-up" style="animation-delay: 1s;">
              <div class="info-icon">
                <i class="fas fa-rupee-sign"></i>
            </div>
              <div class="info-content">
                <h4 class="feature-title">Fair Pricing</h4>
                <p class="feature-desc">Transparent & competitive rates</p>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<!-- Quick Booking Section -->
<section id="quick-booking" class="py-5 bg-light section-reveal">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card shadow-lg border-0 quick-booking-card animate-slide-up">
          <div class="card-header bg-gradient-primary text-white text-center position-relative overflow-hidden">
            <div class="header-pattern"></div>
            <div class="position-relative">
              <h3 class="mb-0 animate-fade-in">
                <i class="fas fa-bolt me-2 animate-pulse"></i>Quick Service Request
              </h3>
              <p class="mb-0 mt-2 animate-fade-in" style="animation-delay: 0.2s;">
                Get quotes from multiple providers in minutes
              </p>
            </div>
          </div>
          <div class="card-body p-4">
            <form id="quickBookingForm">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Service Type *</label>
                  <select class="form-select" id="serviceType" required>
                    <option value="">Select service type</option>
                    <option value="electrician">Electrician</option>
                    <option value="plumber">Plumber</option>
                    <option value="carpenter">Carpenter</option>
                    <option value="cleaner">Cleaner</option>
                    <option value="painter">Painter</option>
                    <option value="ac-repair">AC Repair</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Urgency *</label>
                  <select class="form-select" id="urgency" required>
                    <option value="emergency">ðŸš¨ Emergency (ASAP)</option>
                    <option value="urgent" selected>âš¡ Urgent (Today)</option>
                    <option value="flexible">ðŸ“… Flexible (When available)</option>
                  </select>
                  <div class="form-text" id="urgencyHelpText">Emergency jobs are prioritized and targeted within 10 minutes</div>
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold">Location *</label>
                  <div class="input-group">
                    <input type="text" class="form-control" id="location" placeholder="Detecting your location..." required autocomplete="off">
                    <button class="btn btn-outline-primary" type="button" id="getCurrentLocationBtn" title="Get Current Location">
                      <i class="fas fa-map-marker-alt" id="locationIcon"></i>
                    </button>
                  </div>
                  <div class="form-text" id="locationHelpText">Be specific for better quotes</div>
                  <div class="location-status mt-2" id="locationStatus" style="display: none;">
                    <small class="text-muted">
                      <i class="fas fa-spinner fa-spin me-1"></i>
                      <span id="locationStatusText">Detecting your location...</span>
                    </small>
                  </div>
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold">Work Description *</label>
                  <textarea class="form-control" id="workDescription" rows="3" placeholder="Describe the work you need done..." required></textarea>
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold">
                    <i class="fas fa-microphone me-2"></i>Voice Description (Optional)
                  </label>
                  <div class="voice-recording-container border rounded p-3 bg-light">
                    <div id="voiceRecorderControls" class="d-flex align-items-center gap-2">
                      <button type="button" class="btn btn-outline-danger" id="recordVoiceBtn">
                        <i class="fas fa-microphone me-2"></i>Start Recording
                      </button>
                      <button type="button" class="btn btn-outline-secondary d-none" id="stopVoiceBtn">
                        <i class="fas fa-stop me-2"></i>Stop Recording
                      </button>
                      <button type="button" class="btn btn-outline-info d-none" id="playVoiceBtn">
                        <i class="fas fa-play me-2"></i>Play
                      </button>
                      <button type="button" class="btn btn-outline-danger d-none" id="deleteVoiceBtn">
                        <i class="fas fa-trash me-2"></i>Delete
                      </button>
                      <span id="voiceTimer" class="ms-auto text-muted">00:00</span>
                    </div>
                    <div id="voicePlayerContainer" class="mt-2 d-none">
                      <audio id="voicePlayer" controls class="w-100"></audio>
                    </div>
                    <small class="text-muted d-block mt-2">
                      <i class="fas fa-info-circle me-1"></i>Record your voice description to help providers better understand your needs
                    </small>
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Preferred Date</label>
                  <input type="date" class="form-control" id="preferredDate">
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Preferred Time</label>
                  <select class="form-select" id="preferredTime">
                    <option value="">Any time</option>
                    <option value="morning">Morning (9 AM - 12 PM)</option>
                    <option value="afternoon">Afternoon (12 PM - 5 PM)</option>
                    <option value="evening">Evening (5 PM - 8 PM)</option>
                  </select>
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold">Upload Images (Optional)</label>
                  <input type="file" class="form-control" id="workImages" multiple accept="image/*">
                  <div class="form-text">Upload photos to help providers understand the work needed</div>
                </div>
                <div class="col-12">
                  <button type="submit" class="btn btn-primary btn-lg w-100">
                    <i class="fas fa-search me-2"></i>Find Available Partners
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Featured Services (Image Cards) -->
<section class="py-5 section-reveal">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="display-5 fw-bold animate-text-reveal text-primary">
        Our Services
      </h2>
      <p class="lead text-muted animate-fade-in-up" style="animation-delay: 0.3s;">
        Professional home services at your doorstep
      </p>
    </div>
    <div class="row g-4">
      <div class="col-lg-4 col-md-6">
        <a href="/services?category=electrician" class="text-decoration-none">
          <div class="service-card-image h-100 animate-slide-up" style="animation-delay: 0.1s;">
            <div class="service-cover">
              <img src="{{ url_for('static', filename='images/electrician.jpg') }}" alt="Electrical services" onerror="this.src='https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?q=80&w=1200&auto=format&fit=crop'">
              <div class="service-chip"><i class="fas fa-bolt me-1"></i>Electrical</div>
            </div>
            <div class="service-content">
              <h5 class="mb-2">Electrical Services</h5>
              <p class="text-muted mb-0">Repairs, installations, safety checks and more.</p>
          </div>
        </div>
        </a>
      </div>
      <div class="col-lg-4 col-md-6">
        <a href="/services?category=plumber" class="text-decoration-none">
          <div class="service-card-image h-100 animate-slide-up" style="animation-delay: 0.2s;">
            <div class="service-cover">
              <img src="{{ url_for('static', filename='images/plumber.jpg') }}" alt="Plumbing services" onerror="this.src='https://images.unsplash.com/photo-1581594693700-5c0db1b43f8f?q=80&w=1200&auto=format&fit=crop'">
              <div class="service-chip"><i class="fas fa-wrench me-1"></i>Plumbing</div>
            </div>
            <div class="service-content">
              <h5 class="mb-2">Plumbing Services</h5>
              <p class="text-muted mb-0">Leak repairs, pipe installs, drain cleaning.</p>
          </div>
        </div>
        </a>
      </div>
      <div class="col-lg-4 col-md-6">
        <a href="/services?category=carpenter" class="text-decoration-none">
          <div class="service-card-image h-100 animate-slide-up" style="animation-delay: 0.3s;">
            <div class="service-cover">
              <img src="{{ url_for('static', filename='images/carpenter.jpg') }}" alt="Carpentry services" onerror="this.src='https://images.unsplash.com/photo-1519710164239-da123dc03ef4?q=80&w=1200&auto=format&fit=crop'">
              <div class="service-chip"><i class="fas fa-hammer me-1"></i>Carpentry</div>
            </div>
            <div class="service-content">
              <h5 class="mb-2">Carpentry Services</h5>
              <p class="text-muted mb-0">Furniture repair and custom woodwork.</p>
          </div>
        </div>
        </a>
      </div>
      <div class="col-lg-4 col-md-6">
        <a href="/services?category=cleaner" class="text-decoration-none">
          <div class="service-card-image h-100 animate-slide-up" style="animation-delay: 0.4s;">
            <div class="service-cover">
              <img src="https://images.unsplash.com/photo-1581578731548-c64695cc6952?q=80&w=1200&auto=format&fit=crop" alt="Cleaning services">
              <div class="service-chip"><i class="fas fa-broom me-1"></i>Cleaning</div>
            </div>
            <div class="service-content">
              <h5 class="mb-2">Cleaning Services</h5>
              <p class="text-muted mb-0">Deep cleaning and regular maintenance.</p>
          </div>
        </div>
        </a>
      </div>
      <div class="col-lg-4 col-md-6">
        <a href="/services?category=painter" class="text-decoration-none">
          <div class="service-card-image h-100 animate-slide-up" style="animation-delay: 0.5s;">
            <div class="service-cover">
              <img src="{{ url_for('static', filename='images/painting.jpg') }}" alt="Painting services" onerror="this.src='https://images.unsplash.com/photo-1494905998402-395d579af36f?q=80&w=1200&auto=format&fit=crop'">
              <div class="service-chip"><i class="fas fa-paint-brush me-1"></i>Painting</div>
            </div>
            <div class="service-content">
              <h5 class="mb-2">Painting Services</h5>
              <p class="text-muted mb-0">Interior, exterior, texture and design.</p>
          </div>
        </div>
        </a>
      </div>
      <div class="col-lg-4 col-md-6">
        <a href="/services?category=ac-repair" class="text-decoration-none">
          <div class="service-card-image h-100 animate-slide-up" style="animation-delay: 0.6s;">
            <div class="service-cover">
              <img src="{{ url_for('static', filename='images/ac.jpg') }}" alt="AC services" onerror="this.src='https://images.unsplash.com/photo-1592998387497-2a0a3b3c7b3b?q=80&w=1200&auto=format&fit=crop'">
              <div class="service-chip"><i class="fas fa-snowflake me-1"></i>AC Repair</div>
            </div>
            <div class="service-content">
              <h5 class="mb-2">AC Services</h5>
              <p class="text-muted mb-0">Installation, repair and maintenance.</p>
          </div>
        </div>
        </a>
      </div>
    </div>
  </div>
</section>

<!-- How It Works -->
<section id="how-it-works" class="py-5 bg-light section-reveal">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="display-5 fw-bold text-primary" style="color: #0d6efd !important;">
        How It Works
      </h2>
      <p class="lead text-muted animate-fade-in-up" style="animation-delay: 0.3s;">
        Get your home services in 3 simple steps
      </p>
    </div>
    <div class="row g-4">
      <div class="col-lg-4 text-center">
        <div class="how-it-works-card animate-slide-up" style="animation-delay: 0.1s;">
          <div class="step-icon bg-gradient-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3 animate-pulse">
            <i class="fas fa-clipboard-list fa-lg"></i>
          </div>
          <h4>Request Service</h4>
          <p class="text-muted">Describe your service needs and get instant quotes from verified local professionals.</p>
        </div>
      </div>
      <div class="col-lg-4 text-center">
        <div class="how-it-works-card animate-slide-up" style="animation-delay: 0.3s;">
          <div class="step-icon bg-gradient-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3 animate-pulse" style="animation-delay: 0.2s;">
            <i class="fas fa-balance-scale fa-lg"></i>
          </div>
          <h4>Compare Quotes</h4>
          <p class="text-muted">Review quotes from multiple providers, check their ratings and choose the best one.</p>
        </div>
      </div>
      <div class="col-lg-4 text-center">
        <div class="how-it-works-card animate-slide-up" style="animation-delay: 0.5s;">
          <div class="step-icon bg-gradient-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3 animate-pulse" style="animation-delay: 0.4s;">
            <i class="fas fa-check-circle fa-lg"></i>
          </div>
          <h4>Get It Done</h4>
          <p class="text-muted">Book your preferred provider and get quality service delivered right to your doorstep.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- CTA Section -->
<section class="py-5 section-reveal">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <h2 class="display-5 fw-bold animate-text-reveal text-primary">
          Ready to Get Started?
        </h2>
        <p class="lead text-muted animate-fade-in-up" style="animation-delay: 0.3s;">
          Join thousands of satisfied customers who trust Hofix for their home service needs.
        </p>
      </div>
      <div class="col-lg-4 text-end">
        <a href="#quick-booking" class="btn btn-primary btn-lg btn-animated animate-fade-in-up" style="animation-delay: 0.6s;">
          <i class="fas fa-rocket me-2"></i>Book Service Now
          <span class="btn-ripple"></span>
        </a>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize location detection
  initializeLocationDetection();
  
  // Initialize Google Places Autocomplete if available
  if (typeof google !== 'undefined' && google.maps && google.maps.places) {
    const locationInput = document.getElementById('location');
    const autocomplete = new google.maps.places.Autocomplete(locationInput);
    
    autocomplete.addListener('place_changed', function() {
      const place = autocomplete.getPlace();
      if (place.geometry) {
        // Store coordinates for later use
        locationInput.dataset.lat = place.geometry.location.lat();
        locationInput.dataset.lng = place.geometry.location.lng();
        locationInput.dataset.address = place.formatted_address;
        updateLocationStatus('Location updated manually', 'success');
      }
    });
  }
  
  // Set minimum date to today
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('preferredDate').setAttribute('min', today);
  
  // Voice Recording Functionality
  let mediaRecorder = null;
  let audioChunks = [];
  let recordedAudioBlob = null;
  let recordingTimer = null;
  let recordingStartTime = null;
  
  const recordVoiceBtn = document.getElementById('recordVoiceBtn');
  const stopVoiceBtn = document.getElementById('stopVoiceBtn');
  const playVoiceBtn = document.getElementById('playVoiceBtn');
  const deleteVoiceBtn = document.getElementById('deleteVoiceBtn');
  const voiceTimer = document.getElementById('voiceTimer');
  const voicePlayer = document.getElementById('voicePlayer');
  const voicePlayerContainer = document.getElementById('voicePlayerContainer');
  
  async function startRecording() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream, {
        mimeType: 'audio/webm;codecs=opus'
      });
      
      audioChunks = [];
      
      mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          audioChunks.push(event.data);
        }
      };
      
      mediaRecorder.onstop = () => {
        recordedAudioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        const audioUrl = URL.createObjectURL(recordedAudioBlob);
        voicePlayer.src = audioUrl;
        voicePlayerContainer.classList.remove('d-none');
        
        // Stop all tracks to release microphone
        stream.getTracks().forEach(track => track.stop());
      };
      
      mediaRecorder.start();
      recordingStartTime = Date.now();
      recordVoiceBtn.classList.add('d-none');
      stopVoiceBtn.classList.remove('d-none');
      playVoiceBtn.classList.add('d-none');
      deleteVoiceBtn.classList.add('d-none');
      
      // Start timer
      recordingTimer = setInterval(() => {
        const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        voiceTimer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      }, 1000);
      
    } catch (error) {
      console.error('Error accessing microphone:', error);
      showNotification('Microphone access denied. Please allow microphone access to record voice description.', 'error');
    }
  }
  
  function stopRecording() {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
      mediaRecorder.stop();
      clearInterval(recordingTimer);
      recordingTimer = null;
      
      stopVoiceBtn.classList.add('d-none');
      recordVoiceBtn.classList.remove('d-none');
      playVoiceBtn.classList.remove('d-none');
      deleteVoiceBtn.classList.remove('d-none');
    }
  }
  
  function playRecording() {
    if (recordedAudioBlob && voicePlayer.src) {
      voicePlayer.play();
    }
  }
  
  function deleteRecording() {
    if (confirm('Are you sure you want to delete this recording?')) {
      recordedAudioBlob = null;
      audioChunks = [];
      voicePlayer.src = '';
      voicePlayerContainer.classList.add('d-none');
      voiceTimer.textContent = '00:00';
      playVoiceBtn.classList.add('d-none');
      deleteVoiceBtn.classList.add('d-none');
      
      if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        clearInterval(recordingTimer);
      }
    }
  }
  
  recordVoiceBtn?.addEventListener('click', startRecording);
  stopVoiceBtn?.addEventListener('click', stopRecording);
  playVoiceBtn?.addEventListener('click', playRecording);
  deleteVoiceBtn?.addEventListener('click', deleteRecording);
  
  // Urgency UI logic
  const urgencySelect = document.getElementById('urgency');
  const preferredDateEl = document.getElementById('preferredDate');
  const preferredTimeEl = document.getElementById('preferredTime');
  const urgencyHelpText = document.getElementById('urgencyHelpText');
  function updateUrgencyUI() {
    const v = urgencySelect.value;
    const isEmergency = v === 'emergency';
    preferredDateEl.disabled = isEmergency;
    preferredTimeEl.disabled = isEmergency;
    if (isEmergency) {
      preferredDateEl.value = '';
      preferredTimeEl.value = '';
      preferredDateEl.placeholder = 'ASAP (within 10 minutes)';
      urgencyHelpText.textContent = 'Emergency selected: We will prioritize this job for the next available provider (target â‰¤ 10 minutes).';
    } else {
      preferredDateEl.placeholder = '';
      urgencyHelpText.textContent = 'Choose how quickly you need the service.';
    }
  }
  urgencySelect.addEventListener('change', updateUrgencyUI);
  updateUrgencyUI();
  
  // Quick booking form handler
  document.getElementById('quickBookingForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Check if user is logged in first
    const token = localStorage.getItem('token');
    if (!token) {
      if (confirm('You need to login to submit a service request. Would you like to login now?')) {
        window.location.href = '/login';
      }
      return;
    }
    
    const serviceType = document.getElementById('serviceType').value;
    const urgency = document.getElementById('urgency').value;
    const location = document.getElementById('location').value;
    const workDescription = document.getElementById('workDescription').value;
    const workImages = document.getElementById('workImages').files;
    const preferredDate = document.getElementById('preferredDate').value;
    const preferredTime = document.getElementById('preferredTime').value;
    
    if (!serviceType || !urgency || !location || !workDescription) {
      showNotification('Please fill in all required fields', 'warning');
      return;
    }
    
    // Validate scheduled booking
    if (urgency === 'scheduled' && (!preferredDate || !preferredTime)) {
      showNotification('Please select both date and time for scheduled service', 'warning');
      return;
    }
    
    // Get coordinates if place is selected
    let lat = null;
    let lon = null;
    let address = location;
    
    if (document.getElementById('location').dataset.lat) {
      lat = parseFloat(document.getElementById('location').dataset.lat);
      lon = parseFloat(document.getElementById('location').dataset.lng);
      address = document.getElementById('location').dataset.address;
    }
    
    // Create form data
    const formData = new FormData();
    formData.append('service_type', serviceType);
    formData.append('urgency', urgency);
    formData.append('location', address);
    formData.append('work_description', workDescription);
    // Emergency: freeze date/time and set highest priority with 10 min SLA
    if (urgency === 'emergency') {
      formData.append('preferred_date', today);
      formData.append('preferred_time', 'ASAP');
      formData.append('priority', 'highest');
      formData.append('sla_minutes', '10');
      formData.append('is_emergency', 'true');
    } else {
    formData.append('preferred_date', preferredDate);
    formData.append('preferred_time', preferredTime);
    }
    
    if (lat && lon) {
      formData.append('lat', lat);
      formData.append('lon', lon);
    }
    
    // Add images
    for (let i = 0; i < workImages.length; i++) {
      formData.append('images', workImages[i]);
    }
    
    // Add voice recording if available
    if (recordedAudioBlob) {
      // Convert to audio file with proper extension
      const audioFile = new File([recordedAudioBlob], 'voice_description.webm', {
        type: 'audio/webm'
      });
      formData.append('voice_description', audioFile);
    }
    
    // Submit service request
    submitServiceRequest(formData);
  });
  
  // Smooth scrolling for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });

  // Update stats counters
  function updateStatsCounters(stats) {
    const customersEl = document.getElementById('customersCount');
    const providersEl = document.getElementById('providersCount');
    const servicesEl = document.getElementById('servicesCount');
    
    if (customersEl) {
      customersEl.setAttribute('data-target', stats.customers || 0);
      customersEl.textContent = '0';
    }
    if (providersEl) {
      providersEl.setAttribute('data-target', stats.providers || 0);
      providersEl.textContent = '0';
    }
    if (servicesEl) {
      servicesEl.setAttribute('data-target', stats.categories || 0);
      servicesEl.textContent = '0';
    }
    
    // Animate counters
    if (customersEl) animateCounter(customersEl);
    if (providersEl) animateCounter(providersEl);
    if (servicesEl) animateCounter(servicesEl);
  }

  // Scroll reveal animations
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('revealed');
        
        // Trigger counter animation
        if (entry.target.classList.contains('animate-counter')) {
          animateCounter(entry.target);
        }
      }
    });
  }, observerOptions);

  // Observe all sections with reveal class
  document.querySelectorAll('.section-reveal').forEach(section => {
    observer.observe(section);
  });

  // Load public shops
  fetch('/public/shops?limit=8')
    .then(r => r.ok ? r.json() : [])
    .then(list => renderShops(list))
    .catch(() => {});

  // Load live counters
  fetch('/public/stats')
    .then(r => r.ok ? r.json() : {customers:0, providers:0, categories:0})
    .then(stats => {
      updateStatsCounters(stats);
    })
    .catch(err => {
      console.error('Error loading stats:', err);
    });

  // Counter animation function
  function animateCounter(element) {
    if (!element) return;
    
    const target = parseInt(element.getAttribute('data-target')) || 0;
    if (target === 0) return;
    
    const duration = 2000; // 2 seconds
    const increment = target / (duration / 16); // 60fps
    let current = 0;
    
        const timer = setInterval(() => {
      current += increment;
      if (current >= target) {
        current = target;
        clearInterval(timer);
      }
      element.textContent = Math.floor(current).toLocaleString();
        }, 16);
    
    // Make element visible
    element.style.opacity = '1';
  }

  // Button ripple effect
  document.querySelectorAll('.btn-animated').forEach(button => {
    button.addEventListener('click', function(e) {
      const ripple = this.querySelector('.btn-ripple');
      if (ripple) {
        ripple.style.left = e.offsetX + 'px';
        ripple.style.top = e.offsetY + 'px';
        ripple.style.animation = 'none';
        ripple.offsetHeight; // Trigger reflow
        ripple.style.animation = 'ripple 0.6s linear';
      }
    });
  });
});

// Location Detection Functions
function initializeLocationDetection() {
  const locationInput = document.getElementById('location');
  const getCurrentLocationBtn = document.getElementById('getCurrentLocationBtn');
  const locationIcon = document.getElementById('locationIcon');
  
  // Add click event to location button
  getCurrentLocationBtn.addEventListener('click', getCurrentLocation);
  
  // Initialize autocomplete if Google Maps is available
  if (typeof google !== 'undefined' && google.maps && google.maps.places) {
    initializeLocationAutocomplete();
  }
  
  // Automatically detect location on page load
  getCurrentLocation();
}

function getCurrentLocation() {
  const locationInput = document.getElementById('location');
  const locationIcon = document.getElementById('locationIcon');
  const getCurrentLocationBtn = document.getElementById('getCurrentLocationBtn');
  
  // Show loading state
  updateLocationStatus('Detecting your location...', 'info');
  locationIcon.className = 'fas fa-spinner fa-spin';
  getCurrentLocationBtn.disabled = true;
  
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      function(position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        
        // Store coordinates
        locationInput.dataset.lat = lat;
        locationInput.dataset.lng = lon;
        
        // Reverse geocode to get address
        reverseGeocode(lat, lon);
      },
      function(error) {
        handleLocationError(error);
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 300000 // 5 minutes
      }
    );
  } else {
    handleLocationError({ code: 'NOT_SUPPORTED' });
  }
}

function reverseGeocode(lat, lon) {
  // Try to use Google Geocoding API if available
  if (typeof google !== 'undefined' && google.maps && google.maps.Geocoder) {
    const geocoder = new google.maps.Geocoder();
    const latlng = new google.maps.LatLng(lat, lon);
    
    geocoder.geocode({ location: latlng }, function(results, status) {
      if (status === 'OK' && results[0]) {
        const address = results[0].formatted_address;
        updateLocationInput(address);
        updateLocationStatus('Location detected successfully', 'success');
      } else {
        console.error('Google Geocoding failed:', status);
        // Try fallback service
        useFallbackGeocoding(lat, lon);
      }
      resetLocationButton();
    });
  } else {
    console.log('Google Maps not available, using fallback');
    useFallbackGeocoding(lat, lon);
  }
}

function useFallbackGeocoding(lat, lon) {
  // Use BigDataCloud API as fallback
  fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`)
    .then(response => response.json())
    .then(data => {
      console.log('BigDataCloud response:', data);
      if (data.locality && data.city) {
        const address = `${data.locality}, ${data.city}, ${data.countryName}`;
        updateLocationInput(address);
        updateLocationStatus('Location detected successfully', 'success');
      } else if (data.principalSubdivision && data.countryName) {
        const address = `${data.principalSubdivision}, ${data.countryName}`;
        updateLocationInput(address);
        updateLocationStatus('Location detected successfully', 'success');
      } else {
        updateLocationInput(`Location: ${lat.toFixed(4)}, ${lon.toFixed(4)}`);
        updateLocationStatus('Location detected (coordinates only)', 'warning');
      }
      resetLocationButton();
    })
    .catch(error => {
      console.error('Fallback geocoding error:', error);
      updateLocationInput(`Location: ${lat.toFixed(4)}, ${lon.toFixed(4)}`);
      updateLocationStatus('Location detected (coordinates only)', 'warning');
      resetLocationButton();
    });
}

function updateLocationInput(address) {
  const locationInput = document.getElementById('location');
  locationInput.value = address;
  locationInput.placeholder = 'Enter your address';
}

function updateLocationStatus(message, type) {
  const locationStatus = document.getElementById('locationStatus');
  const locationStatusText = document.getElementById('locationStatusText');
  const statusIcon = locationStatus.querySelector('i');
  
  locationStatusText.textContent = message;
  locationStatus.style.display = 'block';
  
  // Update icon based on type
  statusIcon.className = type === 'success' ? 'fas fa-check-circle me-1 text-success' :
                        type === 'warning' ? 'fas fa-exclamation-triangle me-1 text-warning' :
                        type === 'error' ? 'fas fa-times-circle me-1 text-danger' :
                        'fas fa-spinner fa-spin me-1';
  
  // Auto-hide success messages after 3 seconds
  if (type === 'success') {
    setTimeout(() => {
      locationStatus.style.display = 'none';
    }, 3000);
  }
}

function handleLocationError(error) {
  const locationInput = document.getElementById('location');
  let errorMessage = 'Unable to detect location';
  
  switch(error.code) {
    case 'PERMISSION_DENIED':
      errorMessage = 'Location access denied. Please allow location access or enter manually.';
      break;
    case 'POSITION_UNAVAILABLE':
      errorMessage = 'Location information unavailable. Please enter manually.';
      break;
    case 'TIMEOUT':
      errorMessage = 'Location request timed out. Please try again or enter manually.';
      break;
    case 'NOT_SUPPORTED':
      errorMessage = 'Geolocation not supported. Please enter your location manually.';
      break;
  }
  
  updateLocationStatus(errorMessage, 'error');
  locationInput.placeholder = 'Enter your address manually';
  resetLocationButton();
}

function resetLocationButton() {
  const locationIcon = document.getElementById('locationIcon');
  const getCurrentLocationBtn = document.getElementById('getCurrentLocationBtn');
  
  locationIcon.className = 'fas fa-map-marker-alt';
  getCurrentLocationBtn.disabled = false;
}

// Counter animation function
function animateCounter(element) {
  const target = parseInt(element.dataset.target);
  const counter = element.querySelector('.counter');
  const duration = 2000; // 2 seconds
  const increment = target / (duration / 16); // 60fps
  let current = 0;

  const timer = setInterval(() => {
    current += increment;
    if (current >= target) {
      current = target;
      clearInterval(timer);
    }
    counter.textContent = Math.floor(current) + '+';
  }, 16);
}

// Render shops
function renderShops(list) {
  const grid = document.getElementById('shopsGrid');
  if (!grid) return;
  grid.innerHTML = '';
  if (!list || list.length === 0) {
    grid.innerHTML = `
      <div class="col-12">
        <div class="shops-empty">
          <i class="fas fa-store"></i>
          <h4>No shops available yet</h4>
          <p>We're working on adding local shops in your area. Check back soon!</p>
        </div>
      </div>`;
    return;
  }
  list.forEach(s => {
    const col = document.createElement('div');
    col.className = 'col-sm-6 col-lg-4 col-xl-3';
    col.innerHTML = `
      <div class="shop-card h-100">
        <div class="shop-image">
          ${s.image_url ? 
            `<img src="${s.image_url}" alt="${s.name}" loading="lazy">` : 
            `<div class="shop-image-placeholder">
              <i class="fas fa-store"></i>
            </div>`
          }
        </div>
        <div class="shop-content">
          <div class="shop-header">
            <h5 class="shop-name">${s.name}</h5>
            <span class="shop-category">${s.category}</span>
          </div>
          ${s.address ? `
            <div class="shop-address">
              <i class="fas fa-map-marker-alt"></i>
              ${s.address}
            </div>
          ` : ''}
          <div class="shop-contact">
            ${s.contact_phone ? `
              <a href="tel:${s.contact_phone}" class="contact-item">
                <i class="fas fa-phone"></i>
                ${s.contact_phone}
              </a>
            ` : ''}
            ${s.contact_email ? `
              <a href="mailto:${s.contact_email}" class="contact-item">
                <i class="fas fa-envelope"></i>
                ${s.contact_email}
              </a>
            ` : ''}
          </div>
        </div>
        ${s.website ? `
          <div class="shop-footer">
            <a href="${s.website}" target="_blank" class="shop-website">
              Visit Website
              <i class="fas fa-external-link-alt"></i>
            </a>
          </div>
        ` : ''}
      </div>`;
    grid.appendChild(col);
  });
}

// Notification function
function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  const alertClass = type === 'success' ? 'success' : type === 'warning' ? 'warning' : type === 'error' ? 'danger' : 'info';
  const iconClass = type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : type === 'error' ? 'exclamation-circle' : 'info-circle';
  notification.className = `alert alert-${alertClass} alert-dismissible fade show position-fixed`;
  notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
  notification.innerHTML = `
    <div class="d-flex align-items-center">
      <i class="fas fa-${iconClass} me-2"></i>
      <span>${message}</span>
      <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // Auto-remove after 5 seconds
  setTimeout(() => {
    if (notification.parentNode) {
      notification.remove();
    }
  }, 5000);
}

// Function to submit service request
async function submitServiceRequest(formData) {
  try {
    // Check if user is logged in
    const token = localStorage.getItem('token');
    if (!token) {
      alert('Please login first to submit a service request');
      window.location.href = '/login';
      return;
    }
    
    // Show loading state
    const submitBtn = document.querySelector('#quickBookingForm button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Submitting Request...';
    submitBtn.disabled = true;
    
    const response = await fetch('/api/service-requests', {
      method: 'POST',
      body: formData,
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (response.ok) {
      // Success - show success message and redirect
      showNotification('Service request submitted successfully! Finding providers...', 'success');
      setTimeout(() => {
        window.location.href = `/service-request/${result.request_id}/quotes`;
      }, 2000);
    } else {
      console.error('Service request error:', result);
      if (response.status === 401) {
        showNotification('Session expired. Please login again.', 'warning');
        localStorage.removeItem('token');
        setTimeout(() => {
          window.location.href = '/login';
        }, 2000);
      } else {
        showNotification('Error submitting request: ' + (result.error || 'Unknown error'), 'warning');
      }
    }
  } catch (error) {
    console.error('Error submitting service request:', error);
    showNotification('Error submitting request. Please try again.', 'warning');
  } finally {
    // Reset button state
    const submitBtn = document.querySelector('#quickBookingForm button[type="submit"]');
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  }
}
</script>

<style>
/* Enhanced Hero Section */
.hero-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  position: relative;
  overflow: hidden;
}

.hero-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
}

.floating-shapes {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.shape {
  position: absolute;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 50%;
  animation: float 6s ease-in-out infinite;
}

.shape-1 {
  width: 80px;
  height: 80px;
  top: 20%;
  left: 10%;
  animation-delay: 0s;
}

.shape-2 {
  width: 120px;
  height: 120px;
  top: 60%;
  right: 15%;
  animation-delay: 2s;
}

.shape-3 {
  width: 60px;
  height: 60px;
  top: 80%;
  left: 20%;
  animation-delay: 4s;
}

.shape-4 {
  width: 100px;
  height: 100px;
  top: 30%;
  right: 30%;
  animation-delay: 1s;
}

.shape-5 {
  width: 70px;
  height: 70px;
  top: 70%;
  right: 50%;
  animation-delay: 3s;
}

.shape-6 {
  width: 90px;
  height: 90px;
  top: 10%;
  left: 60%;
  animation-delay: 5s;
}

.particles-container {
  position: absolute;
  width: 100%;
  height: 100%;
}

.hero-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
  z-index: 2;
}

.hero-content {
  position: relative;
  z-index: 3;
}

/* Text Gradient */
.text-gradient {
  background: linear-gradient(45deg, #ffffff, #f8f9fa, #ffffff);
  background-size: 200% 200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradient-shift 3s ease-in-out infinite;
}

/* Website Info Grid */
.website-info-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1.5rem;
  padding: 2rem;
}

.info-card {
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 1.25rem;
  padding: 1.75rem;
  color: white;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.info-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.6s;
}

.info-card:hover::before {
  left: 100%;
}

.info-card:hover {
  transform: translateY(-8px) scale(1.02);
  background: rgba(255, 255, 255, 0.22);
  border-color: rgba(255, 255, 255, 0.35);
  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.2);
}

.info-icon {
  font-size: 2.5rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 60px;
  height: 60px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 1rem;
  transition: all 0.3s ease;
}

.info-card:hover .info-icon {
  transform: scale(1.1) rotate(5deg);
  background: rgba(255, 255, 255, 0.3);
}

.info-content {
  position: relative;
  z-index: 1;
}

.stats-card {
  text-align: center;
}

.stats-number {
  font-size: 2.5rem;
  font-weight: 700;
  margin: 0;
  background: linear-gradient(135deg, #fff 0%, #e0e7ff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1.2;
}

.info-label {
  font-size: 0.875rem;
  font-weight: 500;
  margin: 0.5rem 0 0 0;
  opacity: 0.9;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.feature-card {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  text-align: left;
}

.feature-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin: 0 0 0.5rem 0;
  color: white;
}

.feature-desc {
  font-size: 0.875rem;
  margin: 0;
  opacity: 0.85;
  line-height: 1.5;
}

/* Animation for slide up */
@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-slide-up {
  animation: slideUp 0.6s ease-out forwards;
  opacity: 0;
}

/* Gradient Backgrounds */
.bg-gradient-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.bg-gradient-info {
  background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
}

.bg-gradient-success {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.bg-gradient-warning {
  background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
}

.bg-gradient-danger {
  background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
}

.bg-gradient-secondary {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
}

/* Enhanced Cards */
.service-card {
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  border: 1px solid rgba(0, 0, 0, 0.05);
  position: relative;
  overflow: hidden;
}

.service-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.service-card:hover::before {
  left: 100%;
}

.service-card:hover {
  transform: translateY(-10px) rotateX(5deg);
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
}

.how-it-works-card {
  transition: all 0.3s ease;
  border: 1px solid rgba(0, 0, 0, 0.05);
  padding: 2rem;
  border-radius: 1rem;
  background: white;
}

.how-it-works-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
}

/* Button Animations */
.btn-animated {
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.btn-ripple {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: scale(0);
  animation: ripple 0.6s linear;
  pointer-events: none;
}

.btn-animated:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

/* Header Pattern */
.header-pattern {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="10" cy="60" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="90" cy="40" r="0.5" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
  opacity: 0.3;
}

/* Animations */
@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(5deg); }
}

@keyframes gradient-shift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

@keyframes ripple {
  to {
    transform: scale(4);
    opacity: 0;
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(50px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInLeft {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes textReveal {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

/* Animation Classes */
.animate-fade-in-up {
  animation: fadeInUp 0.8s ease-out forwards;
  opacity: 0;
}


.animate-fade-in-left {
  animation: fadeInLeft 0.6s ease-out forwards;
  opacity: 0;
}

.animate-text-reveal {
  animation: textReveal 1s ease-out forwards;
  opacity: 0;
}

.animate-fade-in {
  animation: fadeInUp 0.6s ease-out forwards;
  opacity: 0;
}

.animate-float {
  animation: float 3s ease-in-out infinite;
}

.animate-pulse {
  animation: pulse 2s ease-in-out infinite;
}

.animate-counter {
  animation: fadeInUp 0.8s ease-out forwards;
  opacity: 0;
}

/* Section Reveal */
.section-reveal {
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.8s ease-out;
}

.section-reveal.revealed {
  opacity: 1;
  transform: translateY(0);
}

/* Counter Animation */
.counter {
  font-variant-numeric: tabular-nums;
}

/* Location Input Styles */
.input-group .btn {
  border-left: none;
}

.input-group .form-control:focus + .btn {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
}

.location-status {
  transition: all 0.3s ease;
}

.location-status .text-success {
  color: #198754 !important;
}

.location-status .text-warning {
  color: #fd7e14 !important;
}

.location-status .text-danger {
  color: #dc3545 !important;
}

#getCurrentLocationBtn {
  transition: all 0.3s ease;
}

#getCurrentLocationBtn:hover {
  background-color: #0d6efd;
  color: white;
}

#getCurrentLocationBtn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Google Places Autocomplete Styling */
.pac-container {
  border-radius: 8px;
  border: 1px solid #e9ecef;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  margin-top: 2px;
  z-index: 1000;
}

.pac-item {
  padding: 8px 12px;
  border-bottom: 1px solid #f8f9fa;
  font-size: 14px;
  cursor: pointer;
}

.pac-item:hover {
  background-color: #f8f9fa;
}

.pac-item:last-child {
  border-bottom: none;
}

.pac-item-query {
  font-weight: 600;
  color: #495057;
}

.pac-matched {
  font-weight: 600;
  color: #667eea;
}

/* Responsive Design */
@media (max-width: 768px) {
  .hero-section {
    min-height: 80vh;
  }
  
  .website-info-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    padding: 1rem;
  }
  
  .info-card {
    padding: 1.25rem;
  }
  
  .info-icon {
    font-size: 2rem;
    width: 50px;
    height: 50px;
    margin-bottom: 0.75rem;
  }
  
  .stats-number {
    font-size: 2rem;
  }
  
  .feature-title {
    font-size: 1rem;
  }
  
  .feature-desc {
    font-size: 0.8rem;
  }
  
  .display-3 {
    font-size: 2.5rem;
  }
  
  .display-5 {
    font-size: 2rem;
  }
  
  .how-it-works-card {
    padding: 1.5rem;
  }
}

@media (max-width: 576px) {
  .website-info-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
    padding: 1rem;
  }
  
  .info-card {
    padding: 1.25rem;
  }
  
  .stats-number {
    font-size: 1.75rem;
  }
  
  .hero-content h1 {
    font-size: 2rem !important;
  }
  
  .btn-lg {
    padding: 0.6rem 1.5rem;
    font-size: 1rem;
  }
}
</style>

<style>
/* Image-based service cards */
.service-card-image {
  background: #fff;
  border-radius: 1rem;
  border: 1px solid rgba(0,0,0,.05);
  box-shadow: 0 8px 24px rgba(0,0,0,.08);
  overflow: hidden;
  transition: transform .35s ease, box-shadow .35s ease;
}

.service-card-image:hover {
  transform: translateY(-8px);
  box-shadow: 0 16px 40px rgba(0,0,0,.15);
}

.service-cover { position: relative; height: 200px; overflow: hidden; }
.service-cover img { width: 100%; height: 100%; object-fit: cover; transition: transform .5s ease; display: block; }
.service-card-image:hover .service-cover img { transform: scale(1.08); }

.service-chip {
  position: absolute; left: 12px; bottom: 12px;
  background: rgba(0,0,0,.6); color: #fff;
  padding: .35rem .6rem; border-radius: .5rem; font-weight: 600; font-size: .85rem;
  backdrop-filter: blur(6px);
}

.service-content { padding: 1rem 1rem 1.25rem; }
.service-content h5 { color: #2d3748; }
.service-content p { color: #6c757d; }

@media (max-width: 576px){
  .service-cover { height: 170px; }
}
</style>

<!-- Feedback Section -->
<section id="feedback" class="py-5 bg-light">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto text-center">
        <h2 class="display-5 fw-bold text-primary mb-4">Share Your Experience</h2>
        <p class="lead text-muted mb-5">Help us improve by sharing your feedback and experience with our services</p>
        
        <!-- Feedback Form -->
        <div class="card shadow-lg border-0">
          <div class="card-body p-4">
            <form id="feedbackForm">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="feedbackName" class="form-label">Your Name *</label>
                  <input type="text" class="form-control" id="feedbackName" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="feedbackEmail" class="form-label">Email Address *</label>
                  <input type="email" class="form-control" id="feedbackEmail" required>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="feedbackTitle" class="form-label">Review Title *</label>
                <input type="text" class="form-control" id="feedbackTitle" placeholder="e.g., Excellent service!" required>
              </div>
              
              <div class="mb-3">
                <label for="feedbackRating" class="form-label">Rating *</label>
                <div class="rating-input">
                  <div class="star-rating" id="feedbackRating">
                    <input type="radio" name="rating" value="5" id="star5" required>
                    <label for="star5" class="star">â˜…</label>
                    <input type="radio" name="rating" value="4" id="star4">
                    <label for="star4" class="star">â˜…</label>
                    <input type="radio" name="rating" value="3" id="star3">
                    <label for="star3" class="star">â˜…</label>
                    <input type="radio" name="rating" value="2" id="star2">
                    <label for="star2" class="star">â˜…</label>
                    <input type="radio" name="rating" value="1" id="star1">
                    <label for="star1" class="star">â˜…</label>
                  </div>
                </div>
              </div>
              
              <div class="mb-4">
                <label for="feedbackMessage" class="form-label">Your Experience *</label>
                <textarea class="form-control" id="feedbackMessage" rows="4" 
                          placeholder="Tell us about your experience with our services..." required></textarea>
              </div>
              
              <button type="submit" class="btn btn-primary btn-lg px-5">
                <i class="fas fa-paper-plane me-2"></i>Submit Feedback
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Featured Reviews Section -->
<section id="reviews" class="py-5 bg-white">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto text-center">
        <h2 class="display-5 fw-bold text-primary mb-4">What Our Customers Say</h2>
        <p class="lead text-muted mb-5">Real feedback from satisfied customers</p>
        
        <!-- Reviews Stats -->
        <div class="row mb-5">
          <div class="col-md-4">
            <div class="text-center">
              <div class="display-4 fw-bold text-primary" id="averageRating">4.8</div>
              <div class="text-muted">Average Rating</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="text-center">
              <div class="display-4 fw-bold text-primary" id="totalReviews">0</div>
              <div class="text-muted">Total Reviews</div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="text-center">
              <div class="display-4 fw-bold text-primary">98%</div>
              <div class="text-muted">Customer Satisfaction</div>
            </div>
          </div>
        </div>
        
        <!-- Featured Reviews Grid -->
        <div class="row" id="featuredReviews"></div>
        
        <!-- Load More Button -->
        <div class="text-center mt-4">
          <button class="btn btn-outline-primary" id="loadMoreReviews" style="display: none;">
            <i class="fas fa-plus me-2"></i>Load More Reviews
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
// Feedback form submission
document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const formData = {
    name: document.getElementById('feedbackName').value,
    email: document.getElementById('feedbackEmail').value,
    title: document.getElementById('feedbackTitle').value,
    rating: document.querySelector('input[name="rating"]:checked').value,
    message: document.getElementById('feedbackMessage').value
  };
  
  try {
    const response = await fetch('/api/feedback/submit', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
      },
      body: JSON.stringify(formData)
    });
    
    const result = await response.json();
    
    if (response.ok) {
      // Show success message
      showNotification('Thank you for your feedback! Your review has been submitted.', 'success');
      
      // Reset form
      document.getElementById('feedbackForm').reset();
      
      // Reload reviews
      loadFeaturedReviews();
    } else {
      showNotification(result.error || 'Failed to submit feedback', 'error');
    }
  } catch (error) {
    console.error('Error submitting feedback:', error);
    showNotification('Failed to submit feedback. Please try again.', 'error');
  }
});

// Load featured reviews
async function loadFeaturedReviews() {
  try {
    const response = await fetch('/api/feedback/featured');
    const data = await response.json();
    
    if (response.ok) {
      displayReviews(data.feedback);
      loadFeedbackStats();
    }
  } catch (error) {
    console.error('Error loading reviews:', error);
  }
}

// Display reviews
function displayReviews(reviews) {
  const container = document.getElementById('featuredReviews');
  
  if (reviews.length === 0) {
    container.innerHTML = `
      <div class="col-12 text-center text-muted py-5">
        <div class="empty-reviews">
          <i class="fas fa-comments fa-3x text-muted mb-3"></i>
          <h4 class="text-muted">No reviews yet</h4>
          <p class="text-muted">Be the first to share your experience!</p>
        </div>
      </div>`;
    return;
  }
  
  container.innerHTML = reviews.map(review => {
    const stars = 'â˜…'.repeat(review.rating) + 'â˜†'.repeat(5 - review.rating);
    const initials = review.name?.split(' ').map(n => n.charAt(0)).join('').toUpperCase() || 'U';
    const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe'];
    const bgColor = colors[Math.floor(Math.random() * colors.length)];
    
    return `
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="review-card h-100">
          <div class="review-header">
            <div class="review-avatar" style="background: linear-gradient(135deg, ${bgColor}, ${bgColor}dd);">
              ${initials}
            </div>
            <div class="review-info">
              <h6 class="reviewer-name">${review.name || 'User'}</h6>
              <div class="review-stars">${stars}</div>
            </div>
          </div>
          <div class="review-content">
            <h6 class="review-title">${review.title || ''}</h6>
            <p class="review-message">${review.message || ''}</p>
          </div>
          <div class="review-footer">
            <small class="review-date">${review.created_at || ''}</small>
          </div>
        </div>
      </div>`;
  }).join('');
}

// Load feedback statistics
async function loadFeedbackStats() {
  try {
    const response = await fetch('/api/feedback/stats');
    const data = await response.json();
    
    if (response.ok) {
      document.getElementById('averageRating').textContent = data.average_rating;
      document.getElementById('totalReviews').textContent = data.total_feedback;
    }
  } catch (error) {
    console.error('Error loading feedback stats:', error);
  }
}

// Show notification
function showNotification(message, type) {
  const notification = document.createElement('div');
  notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
  notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
  notification.innerHTML = `
    ${message}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    if (notification.parentNode) {
      notification.parentNode.removeChild(notification);
    }
  }, 5000);
}

// Load reviews on page load
document.addEventListener('DOMContentLoaded', function() {
  loadFeaturedReviews();
});
</script>

<style>
/* Star Rating Styles */
.rating-input {
  display: flex;
  justify-content: center;
  margin: 1rem 0;
}

.star-rating {
  display: flex;
  flex-direction: row-reverse;
  gap: 0.25rem;
}

.star-rating input[type="radio"] {
  display: none;
}

.star-rating label {
  font-size: 2rem;
  color: #ddd;
  cursor: pointer;
  transition: color 0.2s;
}

.star-rating input[type="radio"]:checked ~ label,
.star-rating label:hover,
.star-rating label:hover ~ label {
  color: #ffc107;
}

/* Avatar Styles */
.avatar {
  font-weight: bold;
  font-size: 1.2rem;
}

/* Modern Review Card Styles */
.review-card {
  background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
  border: none;
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  overflow: hidden;
  position: relative;
  padding: 1.5rem;
}

.review-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.review-card:hover::before {
  opacity: 1;
}

.review-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
}

.review-header {
  display: flex;
  align-items: center;
  margin-bottom: 1rem;
}

.review-avatar {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  font-size: 1.2rem;
  margin-right: 1rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.review-info {
  flex: 1;
}

.reviewer-name {
  font-weight: 700;
  color: #2d3748;
  margin: 0 0 0.25rem 0;
  font-size: 1rem;
}

.review-stars {
  color: #ffc107;
  font-size: 1rem;
  letter-spacing: 1px;
}

.review-content {
  margin-bottom: 1rem;
}

.review-title {
  font-weight: 600;
  color: #4a5568;
  margin-bottom: 0.75rem;
  font-size: 1rem;
}

.review-message {
  color: #718096;
  line-height: 1.6;
  margin: 0;
  font-size: 0.9rem;
}

.review-footer {
  border-top: 1px solid rgba(0, 0, 0, 0.05);
  padding-top: 0.75rem;
}

.review-date {
  color: #a0aec0;
  font-weight: 500;
}

.empty-reviews {
  padding: 3rem 2rem;
}

.empty-reviews i {
  opacity: 0.3;
}

/* Modern Shop Cards */
.shop-card {
  background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
  border: none;
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  overflow: hidden;
  position: relative;
}

.shop-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.shop-card:hover::before {
  opacity: 1;
}

.shop-card:hover {
  transform: translateY(-12px) scale(1.02);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
}

.shop-image {
  height: 200px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  position: relative;
  overflow: hidden;
}

.shop-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.4s ease;
}

.shop-card:hover .shop-image img {
  transform: scale(1.1);
}

.shop-image-placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: white;
  font-size: 3rem;
  opacity: 0.8;
}

.shop-content {
  padding: 1.5rem;
}

.shop-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 1rem;
}

.shop-name {
  font-size: 1.25rem;
  font-weight: 700;
  color: #2d3748;
  margin: 0;
  line-height: 1.3;
}

.shop-category {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.shop-address {
  color: #718096;
  font-size: 0.9rem;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
}

.shop-address i {
  margin-right: 0.5rem;
  color: #667eea;
}

.shop-contact {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.contact-item {
  display: flex;
  align-items: center;
  color: #4a5568;
  font-size: 0.9rem;
  text-decoration: none;
  transition: color 0.3s ease;
}

.contact-item:hover {
  color: #667eea;
}

.contact-item i {
  width: 20px;
  margin-right: 0.75rem;
  color: #667eea;
}

.shop-footer {
  padding: 1rem 1.5rem;
  background: rgba(102, 126, 234, 0.05);
  border-top: 1px solid rgba(102, 126, 234, 0.1);
}

.shop-website {
  color: #667eea;
  text-decoration: none;
  font-weight: 600;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  transition: all 0.3s ease;
}

.shop-website:hover {
  color: #764ba2;
  transform: translateX(4px);
}

.shop-website i {
  margin-left: 0.5rem;
  transition: transform 0.3s ease;
}

.shop-website:hover i {
  transform: translateX(2px);
}

.bg-gradient-light {
  background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
}

.text-gradient-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Empty State */
.shops-empty {
  text-align: center;
  padding: 4rem 2rem;
  color: #718096;
}

.shops-empty i {
  font-size: 4rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.shops-empty h4 {
  color: #4a5568;
  margin-bottom: 0.5rem;
}

.shops-empty p {
  margin: 0;
}
</style>

<!-- Local Shops Near You Section -->
<section class="py-5 bg-gradient-light section-reveal">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="display-5 fw-bold text-primary" style="color: #0d6efd !important;">
        Local Shops Near You
      </h2>
      <p class="lead text-muted animate-fade-in-up" style="animation-delay: 0.3s;">
        Discover trusted hardware, electricals, plumbing and more in your area
      </p>
    </div>
    <div class="row g-4" id="shopsGrid"></div>
  </div>
</section>
{% endblock %}