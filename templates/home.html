{% extends "base.html" %}

{% block title %}Hofix - Home Services Made Easy{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section bg-primary text-white py-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <h1 class="display-4 fw-bold mb-4">Home Services Made Easy</h1>
        <p class="lead mb-4">Connect with trusted local professionals for all your home service needs. From plumbing to electrical work, we've got you covered.</p>
        <div class="d-flex gap-3">
          <a href="#quick-booking" class="btn btn-light btn-lg">
            <i class="fas fa-calendar-plus me-2"></i>Book Now
          </a>
          <a href="#how-it-works" class="btn btn-outline-light btn-lg">
            <i class="fas fa-play me-2"></i>How It Works
          </a>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="hero-image text-center">
          <i class="fas fa-tools display-1 text-warning"></i>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Quick Booking Section -->
<section id="quick-booking" class="py-5 bg-light">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card shadow-lg border-0">
          <div class="card-header bg-primary text-white text-center">
            <h3 class="mb-0">
              <i class="fas fa-bolt me-2"></i>Quick Service Request
            </h3>
            <p class="mb-0 mt-2">Get quotes from multiple providers in minutes</p>
          </div>
          <div class="card-body p-4">
            <form id="quickBookingForm">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Service Type *</label>
                  <select class="form-select" id="serviceType" required>
                    <option value="">Select service type</option>
                    <option value="electrician">Electrician</option>
                    <option value="plumber">Plumber</option>
                    <option value="carpenter">Carpenter</option>
                    <option value="cleaner">Cleaner</option>
                    <option value="painter">Painter</option>
                    <option value="ac-repair">AC Repair</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Urgency *</label>
                  <select class="form-select" id="urgency" required>
                    <option value="emergency">ðŸš¨ Emergency (ASAP)</option>
                    <option value="urgent">âš¡ Urgent (Today)</option>
                    <option value="normal" selected>ðŸ“‹ Normal (This week)</option>
                    <option value="flexible">ðŸ“… Flexible (When available)</option>
                  </select>
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold">Location *</label>
                  <input type="text" class="form-control" id="location" placeholder="Enter your address" required>
                  <div class="form-text">Be specific for better quotes</div>
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold">Work Description *</label>
                  <textarea class="form-control" id="workDescription" rows="3" placeholder="Describe the work you need done..." required></textarea>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Preferred Date</label>
                  <input type="date" class="form-control" id="preferredDate">
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Preferred Time</label>
                  <select class="form-select" id="preferredTime">
                    <option value="">Any time</option>
                    <option value="morning">Morning (9 AM - 12 PM)</option>
                    <option value="afternoon">Afternoon (12 PM - 5 PM)</option>
                    <option value="evening">Evening (5 PM - 8 PM)</option>
                  </select>
                </div>
                <div class="col-12">
                  <label class="form-label fw-semibold">Upload Images (Optional)</label>
                  <input type="file" class="form-control" id="workImages" multiple accept="image/*">
                  <div class="form-text">Upload photos to help providers understand the work needed</div>
                </div>
                <div class="col-12">
                  <button type="submit" class="btn btn-primary btn-lg w-100">
                    <i class="fas fa-search me-2"></i>Find Available Partners
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Featured Services -->
<section class="py-5">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="display-5 fw-bold">Our Services</h2>
      <p class="lead text-muted">Professional home services at your doorstep</p>
    </div>
    <div class="row g-4">
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm hover-lift">
          <div class="card-body text-center p-4">
            <div class="service-icon bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
              <i class="fas fa-bolt fa-lg"></i>
            </div>
            <h5 class="card-title">Electrical Services</h5>
            <p class="card-text text-muted">Professional electrical repairs, installations, and maintenance services.</p>
            <ul class="list-unstyled text-start">
              <li><i class="fas fa-check text-success me-2"></i>Wiring & Rewiring</li>
              <li><i class="fas fa-check text-success me-2"></i>Outlet Installation</li>
              <li><i class="fas fa-check text-success me-2"></i>Circuit Breaker Repair</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm hover-lift">
          <div class="card-body text-center p-4">
            <div class="service-icon bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
              <i class="fas fa-wrench fa-lg"></i>
            </div>
            <h5 class="card-title">Plumbing Services</h5>
            <p class="card-text text-muted">Expert plumbing solutions for leaks, repairs, and installations.</p>
            <ul class="list-unstyled text-start">
              <li><i class="fas fa-check text-success me-2"></i>Leak Repairs</li>
              <li><i class="fas fa-check text-success me-2"></i>Pipe Installation</li>
              <li><i class="fas fa-check text-success me-2"></i>Drain Cleaning</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm hover-lift">
          <div class="card-body text-center p-4">
            <div class="service-icon bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
              <i class="fas fa-hammer fa-lg"></i>
            </div>
            <h5 class="card-title">Carpentry Services</h5>
            <p class="card-text text-muted">Custom woodwork, furniture repair, and carpentry solutions.</p>
            <ul class="list-unstyled text-start">
              <li><i class="fas fa-check text-success me-2"></i>Furniture Repair</li>
              <li><i class="fas fa-check text-success me-2"></i>Cabinet Installation</li>
              <li><i class="fas fa-check text-success me-2"></i>Custom Woodwork</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm hover-lift">
          <div class="card-body text-center p-4">
            <div class="service-icon bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
              <i class="fas fa-broom fa-lg"></i>
            </div>
            <h5 class="card-title">Cleaning Services</h5>
            <p class="card-text text-muted">Professional cleaning services for your home and office.</p>
            <ul class="list-unstyled text-start">
              <li><i class="fas fa-check text-success me-2"></i>Deep Cleaning</li>
              <li><i class="fas fa-check text-success me-2"></i>Regular Maintenance</li>
              <li><i class="fas fa-check text-success me-2"></i>Post-Construction Cleanup</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm hover-lift">
          <div class="card-body text-center p-4">
            <div class="service-icon bg-danger text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
              <i class="fas fa-paint-brush fa-lg"></i>
            </div>
            <h5 class="card-title">Painting Services</h5>
            <p class="card-text text-muted">Interior and exterior painting with premium quality materials.</p>
            <ul class="list-unstyled text-start">
              <li><i class="fas fa-check text-success me-2"></i>Interior Painting</li>
              <li><i class="fas fa-check text-success me-2"></i>Exterior Painting</li>
              <li><i class="fas fa-check text-success me-2"></i>Wall Texture & Design</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-4 col-md-6">
        <div class="card h-100 border-0 shadow-sm hover-lift">
          <div class="card-body text-center p-4">
            <div class="service-icon bg-secondary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
              <i class="fas fa-snowflake fa-lg"></i>
            </div>
            <h5 class="card-title">AC Services</h5>
            <p class="card-text text-muted">Air conditioning installation, repair, and maintenance services.</p>
            <ul class="list-unstyled text-start">
              <li><i class="fas fa-check text-success me-2"></i>AC Repair</li>
              <li><i class="fas fa-check text-success me-2"></i>Installation</li>
              <li><i class="fas fa-check text-success me-2"></i>Maintenance</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- How It Works -->
<section id="how-it-works" class="py-5 bg-light">
  <div class="container">
    <div class="text-center mb-5">
      <h2 class="display-5 fw-bold">How It Works</h2>
      <p class="lead text-muted">Get your home services in 3 simple steps</p>
    </div>
    <div class="row g-4">
      <div class="col-lg-4 text-center">
        <div class="step-number bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px; font-size: 2rem;">
          1
        </div>
        <h4>Request Service</h4>
        <p class="text-muted">Describe your service needs and get instant quotes from verified local professionals.</p>
      </div>
      <div class="col-lg-4 text-center">
        <div class="step-number bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px; font-size: 2rem;">
          2
        </div>
        <h4>Compare Quotes</h4>
        <p class="text-muted">Review quotes from multiple providers, check their ratings and choose the best one.</p>
      </div>
      <div class="col-lg-4 text-center">
        <div class="step-number bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px; font-size: 2rem;">
          3
        </div>
        <h4>Get It Done</h4>
        <p class="text-muted">Book your preferred provider and get quality service delivered right to your doorstep.</p>
      </div>
    </div>
  </div>
</section>

<!-- Stats Section -->
<section class="py-5 bg-primary text-white">
  <div class="container">
    <div class="row text-center">
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-item">
          <h3 class="display-4 fw-bold">500+</h3>
          <p class="lead">Happy Customers</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-item">
          <h3 class="display-4 fw-bold">100+</h3>
          <p class="lead">Verified Providers</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-item">
          <h3 class="display-4 fw-bold">50+</h3>
          <p class="lead">Service Categories</p>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 mb-4">
        <div class="stat-item">
          <h3 class="display-4 fw-bold">24/7</h3>
          <p class="lead">Customer Support</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- CTA Section -->
<section class="py-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <h2 class="display-5 fw-bold">Ready to Get Started?</h2>
        <p class="lead text-muted">Join thousands of satisfied customers who trust Hofix for their home service needs.</p>
      </div>
      <div class="col-lg-4 text-end">
        <a href="#quick-booking" class="btn btn-primary btn-lg">
          <i class="fas fa-rocket me-2"></i>Book Service Now
        </a>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Initialize Google Places Autocomplete if available
  if (typeof google !== 'undefined' && google.maps && google.maps.places) {
    const locationInput = document.getElementById('location');
    const autocomplete = new google.maps.places.Autocomplete(locationInput);
    
    autocomplete.addListener('place_changed', function() {
      const place = autocomplete.getPlace();
      if (place.geometry) {
        // Store coordinates for later use
        locationInput.dataset.lat = place.geometry.location.lat();
        locationInput.dataset.lng = place.geometry.location.lng();
        locationInput.dataset.address = place.formatted_address;
      }
    });
  }
  
  // Set minimum date to today
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('preferredDate').setAttribute('min', today);
  
  // Quick booking form handler
  document.getElementById('quickBookingForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Check if user is logged in first
    const token = localStorage.getItem('token');
    if (!token) {
      if (confirm('You need to login to submit a service request. Would you like to login now?')) {
        window.location.href = '/login';
      }
      return;
    }
    
    const serviceType = document.getElementById('serviceType').value;
    const urgency = document.getElementById('urgency').value;
    const location = document.getElementById('location').value;
    const workDescription = document.getElementById('workDescription').value;
    const workImages = document.getElementById('workImages').files;
    const preferredDate = document.getElementById('preferredDate').value;
    const preferredTime = document.getElementById('preferredTime').value;
    
    if (!serviceType || !urgency || !location || !workDescription) {
      showNotification('Please fill in all required fields', 'warning');
      return;
    }
    
    // Validate scheduled booking
    if (urgency === 'scheduled' && (!preferredDate || !preferredTime)) {
      showNotification('Please select both date and time for scheduled service', 'warning');
      return;
    }
    
    // Get coordinates if place is selected
    let lat = null;
    let lon = null;
    let address = location;
    
    if (document.getElementById('location').dataset.lat) {
      lat = parseFloat(document.getElementById('location').dataset.lat);
      lon = parseFloat(document.getElementById('location').dataset.lng);
      address = document.getElementById('location').dataset.address;
    }
    
    // Create form data
    const formData = new FormData();
    formData.append('service_type', serviceType);
    formData.append('urgency', urgency);
    formData.append('location', address);
    formData.append('work_description', workDescription);
    formData.append('preferred_date', preferredDate);
    formData.append('preferred_time', preferredTime);
    
    if (lat && lon) {
      formData.append('lat', lat);
      formData.append('lon', lon);
    }
    
    // Add images
    for (let i = 0; i < workImages.length; i++) {
      formData.append('images', workImages[i]);
    }
    
    // Submit service request
    submitServiceRequest(formData);
  });
  
  // Smooth scrolling for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
});

// Notification function
function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `alert alert-${type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info'} alert-dismissible fade show position-fixed`;
  notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
  notification.innerHTML = `
    <div class="d-flex align-items-center">
      <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
      <span>${message}</span>
      <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // Auto-remove after 5 seconds
  setTimeout(() => {
    if (notification.parentNode) {
      notification.remove();
    }
  }, 5000);
}

// Function to submit service request
async function submitServiceRequest(formData) {
  try {
    // Check if user is logged in
    const token = localStorage.getItem('token');
    if (!token) {
      alert('Please login first to submit a service request');
      window.location.href = '/login';
      return;
    }
    
    // Show loading state
    const submitBtn = document.querySelector('#quickBookingForm button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Submitting Request...';
    submitBtn.disabled = true;
    
    const response = await fetch('/api/service-requests', {
      method: 'POST',
      body: formData,
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (response.ok) {
      // Success - show success message and redirect
      showNotification('Service request submitted successfully! Finding providers...', 'success');
      setTimeout(() => {
        window.location.href = `/service-request/${result.request_id}/quotes`;
      }, 2000);
    } else {
      console.error('Service request error:', result);
      if (response.status === 401) {
        showNotification('Session expired. Please login again.', 'warning');
        localStorage.removeItem('token');
        setTimeout(() => {
          window.location.href = '/login';
        }, 2000);
      } else {
        showNotification('Error submitting request: ' + (result.error || 'Unknown error'), 'warning');
      }
    }
  } catch (error) {
    console.error('Error submitting service request:', error);
    showNotification('Error submitting request. Please try again.', 'warning');
  } finally {
    // Reset button state
    const submitBtn = document.querySelector('#quickBookingForm button[type="submit"]');
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  }
}
</script>

<style>
.hero-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.hover-lift {
  transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
}

.hover-lift:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.step-number {
  font-weight: bold;
}

.stat-item h3 {
  margin-bottom: 0.5rem;
}

.service-icon {
  transition: transform 0.3s ease-in-out;
}

.service-icon:hover {
  transform: scale(1.1);
}

@media (max-width: 768px) {
  .display-4 {
    font-size: 2.5rem;
  }
  
  .display-5 {
    font-size: 2rem;
  }
}
</style>
{% endblock %}